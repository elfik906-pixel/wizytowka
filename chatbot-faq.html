<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chatbot FAQ ‚Äì Mini chat Q&amp;A</title>
  <meta name="description" content="Lekki Mini chat Q&A z lokalnƒÖ bazƒÖ pyta≈Ñ i odpowiedzi per u≈ºytkownik." />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* ===== Mini chat Q&A (namespaced; mo≈ºna przenie≈õƒá do style.css) ===== */
    .miniqa-page { min-height: 100dvh; display: grid; grid-template-rows: auto 1fr auto; }
    .miniqa-wrap { margin: 2rem auto; max-width: 820px; padding: 0 1rem; width: 100%; }
    .miniqa-card { background:#4a3b60; border-radius:14px; box-shadow:0 10px 25px rgba(0,0,0,.25); color:#fff; overflow:hidden; }
    .miniqa-header{ display:flex; flex-wrap:wrap; align-items:center; gap:.75rem 1rem; justify-content:space-between; padding:1rem 1.25rem; background:#3d2f54; border-bottom:1px solid rgba(255,255,255,.08); }
    .miniqa-brand{ display:flex; align-items:center; gap:.6rem; }
    .miniqa-logo{ font-size:1.4rem; }
    .miniqa-brand h2{ margin:0; font-size:1.25rem; font-weight:800; }
    .miniqa-badge{ padding:.15rem .5rem; font-size:.7rem; border-radius:999px; background:#7d8cff; color:#101020; }
    .miniqa-user{ display:flex; align-items:center; gap:.5rem; font-size:.95rem; }
    .miniqa-user input{ background:rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.18); border-radius:8px; padding:.45rem .6rem; color:#fff; outline:none; width:200px; }
    .miniqa-history{ height:420px; overflow:auto; padding:1rem; display:flex; flex-direction:column; gap:.6rem; background:radial-gradient(1200px 400px at 50% -10%, rgba(255,255,255,.06), transparent) #3f3257; }
    .miniqa-msg{ max-width:80%; padding:.65rem .8rem; border-radius:12px; position:relative; line-height:1.35; word-break: break-word; }
    .miniqa-msg time{ display:block; font-size:.7rem; opacity:.75; margin-top:.25rem; }
    .miniqa-msg--user{ align-self:flex-end; background:#8ec97f; color:#102010; border-bottom-right-radius:6px; }
    .miniqa-msg--bot{ align-self:flex-start; background:#2a2140; border:1px solid rgba(255,255,255,.08); border-bottom-left-radius:6px; }
    .miniqa-form{ display:flex; gap:.6rem; padding:.9rem; background:#3d2f54; border-top:1px solid rgba(255,255,255,.08); }
    .miniqa-form input[type="text"]:focus {border-color: #88c06d; box-shadow: 0 0 6px #88c06d80; }   
    .miniqa-btn{ background:#88c06d; color:#102010; border:none; border-radius:10px; padding:.55rem .9rem; font-weight:700; cursor:pointer; }
    .miniqa-btn:hover{ filter:brightness(1.05); }
    .miniqa-btn:active{ transform:translateY(1px); }
    .miniqa-btn--ghost{ background:transparent; color:#e6e6e6; border:1px solid rgba(255,255,255,.25); }
    .miniqa-hint{ margin:0; padding:.6rem 1rem 1rem; font-size:.85rem; opacity:.85; }
    .miniqa-topbar{ display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:1rem; max-width:820px; margin:0 auto; color:#fff; }
    .miniqa-topbar a.btn-back{ background:#2a2140; border:1px solid rgba(255,255,255,.15); color:#fff; text-decoration:none; padding:.5rem .8rem; border-radius:10px; font-weight:700; }
  </style>
</head>
<body class="miniqa-page">
  <!-- g√≥rny pasek z powrotem -->
  <div class="miniqa-topbar">
    <div><strong>Chatbot FAQ ‚Äì demo</strong></div>
    <a class="btn-back" href="projekty.html">‚Üê Wr√≥ƒá do projekt√≥w</a>
  </div>

  <main class="miniqa-wrap">
    <!-- Mini chat Q&A ‚Äì tre≈õƒá demo -->
    <section id="miniqa" class="miniqa">
      <div class="miniqa-card">
        <header class="miniqa-header">
          <div class="miniqa-brand">
            <span class="miniqa-logo">üí¨</span>
            <h2>Mini chat Q&amp;A</h2>
            <span class="miniqa-badge">beta</span>
          </div>
          <label class="miniqa-user">
            <span>U≈ºytkownik:</span>
            <input id="miniqa-userName" type="text" placeholder="np. Dark_Elf" />
          </label>
        </header>

        <div id="miniqa-history" class="miniqa-history" aria-live="polite"></div>

<form id="miniqa-form" class="miniqa-form" autocomplete="off">
  <input id="miniqa-input" type="text" placeholder="Zadaj pytanie‚Ä¶ (Enter)" required aria-label="Tre≈õƒá pytania" />
  <button type="submit" class="miniqa-btn">Wy≈õlij</button>
  <button type="button" id="miniqa-clear" class="miniqa-btn miniqa-btn--ghost" title="Wyczy≈õƒá historiƒô">Wyczy≈õƒá</button>
  <button type="button" id="miniqa-clear-base" class="miniqa-btn miniqa-btn--ghost" title="Wyczy≈õƒá bazƒô Q&amp;A">Wyczy≈õƒá bazƒô Q&amp;A</button>

  <!-- SUGESTIE / SKR√ìTY -->
  <div class="miniqa-suggestions">
    <button type="button" class="miniqa-suggestion">Lista komend</button>
    <button type="button" class="miniqa-suggestion">Poka≈º notatki</button>
    <button type="button" class="miniqa-suggestion">Usu≈Ñ notatki</button>
    <button type="button" class="miniqa-suggestion">Kt√≥ra godzina?</button>
  </div>
</form>


        <p class="miniqa-hint">
          Odpowiedzi trzymane sƒÖ lokalnie w <code>localStorage</code> per <em>userName</em>.
          Gdy brak odpowiedzi w bazie ‚Äì podaj jƒÖ w okienku i zostanie zapisana.
        </p>
      </div>
    </section>
  </main>

  <footer class="miniqa-topbar" style="opacity:.8;">
    <span>¬© 2025 by Dark_Elf</span>
    <a class="btn-back" href="projekty.html">‚Üê Wr√≥ƒá do projekt√≥w</a>
  </footer>

  <!-- Logika mini chatu -->
  <script>
  (() => {
    // LIMITY
    const Q_MAX = 200;  // pytanie
    const A_MAX = 300;  // odpowied≈∫
    const baseKey = (user) => `miniqa_base::${user}`;
    const histKey = (user) => `miniqa_history::${user}`;
    const userKey = "miniqa_userName";

    const elUser = document.getElementById("miniqa-userName");
    const elHistory = document.getElementById("miniqa-history");
    const elForm = document.getElementById("miniqa-form");
    const elInput = document.getElementById("miniqa-input");
    const elClear = document.getElementById("miniqa-clear");

    let userName = localStorage.getItem(userKey) || "Guest";
    elUser.value = userName;
    elUser.addEventListener("change", () => {
      userName = elUser.value.trim() || "Guest";
      localStorage.setItem(userKey, userName);
      renderHistory(); // tylko prze≈Çaduj historiƒô dla nowego usera
    });

    function loadBase(){ try { return JSON.parse(localStorage.getItem(baseKey(userName))) || {}; } catch { return {}; } }
    function saveBase(b){ localStorage.setItem(baseKey(userName), JSON.stringify(b)); }
    function loadHistory(){ try { return JSON.parse(localStorage.getItem(histKey(userName))) || []; } catch { return []; } }
    function saveHistory(h){ localStorage.setItem(histKey(userName), JSON.stringify(h)); }

// --- te dwie rzeczy DAJ POZA handlerem, pod funkcjami pomocniczymi ---
// Powitanie przy pierwszym wej≈õciu
function addWelcomeMessage() {
  const history = loadHistory();
  if (history.length === 0) {
    history.push({
      role: "bot",
      text: "Siemano kolano, elo elo 4.2.0 üöÄ",
      ts: Date.now()
    });
    // Podpowiedzi na chacie
    history.push({
      role: "bot",
      text:
        "Mo≈ºesz zapytaƒá np.:\n" +
        "‚Äì Jak masz na imiƒô?\n" +
        "‚Äì Kt√≥ra godzina?\n" +
        "‚Äì Jak siƒô nazywam?\n" +
        "‚Äì Zapisz notatkƒô: kupiƒá mleko\n" +
        "‚Äì Poka≈º notatki\n" +
        "‚Äì Usu≈Ñ notatki",
      ts: Date.now()
    });

    saveHistory(history);
  }
}

// Sugestie (skr√≥ty) ‚Äì wstawiajƒÖ tekst do inputa
document.querySelectorAll(".miniqa-suggestion").forEach(btn => {
  btn.addEventListener("click", () => {
    elInput.value = btn.textContent;
    elInput.focus();
  });
});

// wywo≈Çanie przy starcie
addWelcomeMessage();  // pokazuje powitanie, je≈õli brak historii
renderHistory();
    // === BOT & NOTATKI (per user) ===
const BOT_NAME = "FAQ-Bot 4.2.0";

// Notatki trzymamy pod osobnym kluczem
const notesKey = (user) => `miniqa_notes::${user}`;
function loadNotes() {
  try { return JSON.parse(localStorage.getItem(notesKey(userName))) || []; }
  catch { return []; }
}
function saveNotes(arr) {
  localStorage.setItem(notesKey(userName), JSON.stringify(arr));
}

    function msg(role, text, ts){
      const d=document.createElement("div");
      d.className = "miniqa-msg miniqa-msg--" + role;
      d.innerHTML = "<div>" + escapeHtml(text) + "</div><time>" + new Date(ts).toLocaleString() + "</time>";
      return d;
    }
    function escapeHtml(s){ return s.replace(/[&<>\"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])); }

    function renderHistory(){
      elHistory.innerHTML = "";
      loadHistory().forEach(m => elHistory.appendChild(msg(m.role, m.text, m.ts)));
      elHistory.scrollTop = elHistory.scrollHeight;
    }

    const norm = s =>
  s
    .toLowerCase()
    .replace(/\s+/g, " ")
    .replace(/[\s?!.,;:‚Ä¶‚Äû‚Äù"'\-‚Äî_]+$/g, "")
    .trim();

    // Baza Q&A (per user) ‚Äì szukanie i zapisywanie odpowiedzi
function findAnswer(q) {
  const base = loadBase();
  return base[norm(q)] || null;
}
function setAnswer(q, a) {
  const base = loadBase();
  base[norm(q)] = a;
  saveBase(base);
}
 
// === INTENTY: wbudowane odpowiedzi ===
// Zwraca string z odpowiedziƒÖ albo null, gdy brak dopasowania
function intentAnswer(rawQuestion) {
  const q = norm(rawQuestion);

  // "lista komend" / "pomoc" / "help"
if (/(lista.*komend|pomoc|help)/.test(q)) {
  return (
    "Przyk≈Çadowe komendy:\n" +
    "‚Äì Jak masz na imiƒô?\n" +
    "‚Äì Kt√≥ra godzina?\n" +
    "‚Äì Jak siƒô nazywam?\n" +
    "‚Äì Zapisz notatkƒô: kupiƒá mleko\n" +
    "‚Äì Poka≈º notatki\n" +
    "‚Äì Usu≈Ñ notatki"
  );
}


  // 1) "jak masz na imiƒô" / "kim jeste≈õ"
  if (/(jak.*imi[eƒô]|kim.*jeste[s≈õ])/.test(q)) {
    return `Jestem ${BOT_NAME}. Ty jeste≈õ u≈ºytkownikiem: ${userName}.`;
  }

  // 2) "kt√≥ra godzina" / "jaka jest data"
  if (/(kt[o√≥]ra.*godzina|jaka.*data|jaki.*dzie[n≈Ñ])/.test(q)) {
    const now = new Date();
    return `Teraz jest ${now.toLocaleString()}.`;
  }

  // 3) "jak siƒô nazywam" / "jaki mam nick/u≈ºytkownik"
  if (/(jak.*nazywam|jaki.*(nick|u[z≈º]ytkownik))/.test(q)) {
    return `Masz ustawionƒÖ nazwƒô u≈ºytkownika: ${userName}.`;
  }

  // 4) Notatki:
  //    "zapisz notatkƒô: ..." (r√≥wnie≈º bez polskich znak√≥w)
  const mSave = q.match(/zapisz\s+notatk[eƒô]\s*[:\-]?\s*(.+)$/);
  if (mSave && mSave[1]) {
    const text = mSave[1].trim();
    if (!text) return "Nie mogƒô zapisaƒá pustej notatki.";
    const arr = loadNotes();
    arr.push({ text, ts: Date.now() });
    saveNotes(arr);
    return `Zapisano notatkƒô (#${arr.length}): "${text}".`;
  }

  //    "poka≈º notatki" / "wy≈õwietl notatki"
  if (/(poka[z≈º]|wy[s≈õ]wietl)\s+notatki/.test(q)) {
    const arr = loadNotes();
    if (arr.length === 0) return "Nie masz jeszcze ≈ºadnych notatek.";
    const lines = arr
      .slice(-10) // ostatnie 10 dla czytelno≈õci
      .map((n, i) => `‚Ä¢ ${n.text} (${new Date(n.ts).toLocaleString()})`);
    return `Twoje notatki (ostatnie ${lines.length}):\n` + lines.join("\n");
  }

  //    "usu≈Ñ notatki" / "wyczy≈õƒá notatki"
  if (/((usu[n≈Ñ])|(wyczy[s≈õ][cƒá]))\s+notatki/.test(q)) {
    if (confirm("UsunƒÖƒá wszystkie notatki dla u≈ºytkownika \"" + userName + "\"?")) {
      saveNotes([]);
      return "Wyczyszczono wszystkie notatki.";
    } else {
      return "Anulowano czyszczenie notatek.";
    }
  }

  return null; // brak dopasowania ‚Üí leci do bazy Q&A
}


elForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const text = elInput.value.trim();
  if (!text) return;

  // Walidacja pytania
  if (text.length > Q_MAX) {
    const histTooLong = loadHistory();
    histTooLong.push({
      role: "bot",
      text: `Pytanie jest za d≈Çugie (max ${Q_MAX} znak√≥w). Skr√≥ƒá je proszƒô.`,
      ts: Date.now()
    });
    saveHistory(histTooLong);
    elInput.value = "";
    renderHistory();
    return;
  }

  const history = loadHistory();
  history.push({ role: "user", text, ts: Date.now() });

  // Najpierw spr√≥buj odpowiedzi wbudowanej (intenty)
let answer = intentAnswer(text);

// Je≈õli brak wbudowanej ‚Üí sprawd≈∫ bazƒô Q&A
if (answer === null) {
  answer = findAnswer(text);
}


  if (!answer) {
    const provided = window.prompt(`Brak odpowiedzi w bazie.\nPodaj odpowied≈∫ (max ${A_MAX} znak√≥w):`);

    if (provided === null) {
      history.push({ role: "bot", text: "Anulowano dodanie odpowiedzi.", ts: Date.now() });
      saveHistory(history);
      elInput.value = "";
      renderHistory();
      return;
    }

    const cleaned = provided.trim();

    if (!cleaned) {
      history.push({ role: "bot", text: "Odpowied≈∫ nie mo≈ºe byƒá pusta ‚Äî nic nie zapisano.", ts: Date.now() });
      saveHistory(history);
      elInput.value = "";
      renderHistory();
      return;
    }

    if (cleaned.length > A_MAX) {
      history.push({ role: "bot", text: `Odpowied≈∫ jest za d≈Çuga (max ${A_MAX} znak√≥w) ‚Äî nic nie zapisano.`, ts: Date.now() });
      saveHistory(history);
      elInput.value = "";
      renderHistory();
      return;
    }

    answer = cleaned;
    setAnswer(text, answer);
  }

  history.push({ role: "bot", text: answer, ts: Date.now() });
  saveHistory(history);

  elInput.value = "";
  renderHistory();
});


    elClear.addEventListener("click", () => {
      if(confirm('Wyczy≈õciƒá historiƒô rozmowy dla u≈ºytkownika "' + userName + '"?')){
        saveHistory([]); renderHistory();
      }
    });
    const elClearBase = document.getElementById("miniqa-clear-base");
if (elClearBase) {
  elClearBase.addEventListener("click", () => {
    if (confirm(`Wyczy≈õciƒá bazƒô Q&A dla u≈ºytkownika "${userName}"?`)) {
      saveBase({});
      alert("Baza Q&A wyczyszczona dla u≈ºytkownika: " + userName);
    }
  });
}

  })();


  </script>

</body>
</html>
